AWSTemplateFormatVersion: "2010-09-09"
Description: "Lambda function"
Parameters:
    SourceBucket:
        Type: String
        Default: lambdatestmw
Resources:
    LambdaS3ExecutionRole:
        Type: AWS::IAM::Role
        Properties:
            RoleName: "LambdaS3ExecutionRole"
            AssumeRolePolicyDocument:
                Version: '2012-10-17'
                Statement:
                    - Effect: Allow
                      Principal:
                          Service:
                              - lambda.amazonaws.com
                      Action:
                          - sts:AssumeRole
            Path: "/"
            Policies:
                - PolicyName: LambdaS3ExecutionRole
                  PolicyDocument:
                      Version: '2012-10-17'
                      Statement:
                          - Action:
                                - logs:*
                                - iam:*
                                - codepipeline:*
                                - s3:*
                            Effect: Allow
                            Resource: '*'
    MyFunction:
        Type: AWS::Lambda::Function
        Properties:
            Role: !GetAtt LambdaS3ExecutionRole.Arn
            Runtime: "nodejs12.x"
            Handler: index.handler
            Code:
                S3Bucket: !Ref 'SourceBucket'
                S3Key: !Sub 'learningpool.zip'


